/*! pinmap - v2.3.0-beta3 -  2013-09-10
  * Copyright (c) 2013 ; 
 */(function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)})(function(e){"use strict";var t=function(t,r){if(this.options=e.extend({latitude:-31.95391,longitude:115.858512,popup:!1,centerOnMarker:!0},r),!t||!e(t).length)return!1;this._bindEvents(this.options),this.$element=e(t),this.markers=[];var o=e.extend({zoom:11,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(this.options.latitude,this.options.longitude)},this.options),n=e('<div class="gm" style="width:100%;height:100%;" />').appendTo(this.$element);return this.google_map=new google.maps.Map(n[0],o),this.options.popup&&(this.popup=this.options.popup),this};return t.prototype._bindEvents=function(e){this.onMarkerClick=e.onMarkerClick||null},t.prototype.addMarker=function(e,t,r,o,n,i){var s=new google.maps.Marker({position:e,map:this.google_map,title:t,icon:o,optimized:!1});return s.id=r,s.popup=this.popup,s.description=n,s.type=i||{},s.current=!1,this.markers.push(s),this._bindMarkerEvents(s),s},t.prototype._bindMarkerEvents=function(e){var t=this;google.maps.event.addListener(e,"click",function(){"function"==typeof t.onMarkerClick?t.onMarkerClick.call(this,t,e):e.popup&&(t.popup.id===e.id?t.popup.close():t.showMarker(e))})},t.prototype.removeMarker=function(e){var t;for(t=this.markers.length-1;t>=0;t--)this.markers[t].id===e&&(this.markers[t].current=!1,this.markers[t].setMap(null),this.markers.slice(t,1))},t.prototype.showMarker=function(e){e.popup.setContent(e.description),this.options.centerOnMarker===!0&&this.centerOnMarker({id:e.id});for(var t=this.markers.length-1;t>=0;t--)this.markers[t].current=!1;e.current=!0,e.popup.open(e.map,e,this)},t.prototype.currentMarker=function(){var e;for(e=0;this.markers.length>e;e++)if(this.markers[e].current)return this.markers[e];return null},t.prototype.nextMarker=function(){var e;for(e=0;this.markers.length>e;e++)if(this.markers[e].current)return this.markers[e+1]!==void 0?this.markers[e+1]:this.markers[0]},t.prototype.nextMarker=function(){var e;for(e=0;this.markers.length>e;e++)if(this.markers[e].current)return this.markers[e+1]!==void 0?this.markers[e+1]:this.markers[0]},t.prototype.previousMarker=function(){var e;for(e=0;this.markers.length>e;e++)if(this.markers[e].current)return this.markers[e-1]!==void 0?this.markers[e-1]:this.markers[this.markers.length-1]},t.prototype.panTo=function(e){return this.google_map.panTo(e)},t.prototype.panToWithOffset=function(e,t,r){var o=this.google_map,n=new google.maps.OverlayView;n.onAdd=function(){var n=this.getProjection(),i=n.fromLatLngToContainerPixel(e);i.x=i.x+t,i.y=i.y+r,o.panTo(n.fromContainerPixelToLatLng(i))},n.draw=function(){},n.setMap(o)},t.prototype.findMarker=function(e){for(var t=this.markers.length-1;t>=0;t--)if(this.markers[t].id===e)return this.markers[t]},t.prototype.centerOnMarker=function(t){var r=t.id||!1,o=t.title||!1,n=t.zoom||!1,i=t.popup||!1,s=this;return r||o?(e.each(this.markers,function(e,t){(t.title===o||t.id===r)&&(s.panTo(t.position),n&&s.google_map.setZoom(n),i&&s.showMarker(t))}),void 0):!1},t.prototype.toggleMarkers=function(t,r){t=t||!1,e.each(this.markers,function(e,o){t&&o.type===t&&("boolean"==typeof r?o.setVisible(r):o.setVisible(!o.visible))})},t.prototype.locateUser=function(t,r){var o=this,n=e.Deferred();if(t=e.extend({pan:!0,marker:!0,icon:null},t),r=r||!1,"geolocation"in navigator)navigator.geolocation.getCurrentPosition(function(e){o.user_coordinates=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),n.resolve(o.user_coordinates),t.pan&&o.panTo(o.user_coordinates),t.marker&&o.addMarker(o.user_coordinates,"Current Location",null,t.icon),r&&r(o.user_coordinates,o)},function(e){n.reject(e),r&&r(!1,o,e)});else{var i="Device does not support geolocation lookup.";n.reject(i),r&&r(!1,o,i)}return n},t.prototype.buildDirectionsUrl=function(e,t){var r="http://maps.apple.com";return e||t?(e&&t?(r=r+"?saddr="+encodeURIComponent(e),r=r+"&daddr="+encodeURIComponent(t)):r=r+"?saddr="+encodeURIComponent(e||t),r):r},e.fn.pinmap=function(r,o){r=r||{},o="function"==typeof o?o:!1,this.each(function(){var n=e(this),i=new google.maps.Geocoder,s=n.data("pinmap"),a=void 0!==n.attr("data-address")?n.attr("data-address"):!1;s||n.data("pinmap",s=new t(this,r)),a&&i.geocode({address:a},function(e,t){var o;t!==google.maps.GeocoderStatus.ZERO_RESULTS&&(o=e[0].geometry.location,s.panTo(o),r.addPin&&s.addMarker(o,a))}),o&&o.call(this,s)})},t}),window.PopupSlider=function(e){"use strict";var t=function(t){return t.length?(this.$element=t.find(".infoslider"),this.$element.length||(this.$element=e('<div class="popup-infoslider"></div>'),t.append(this.$element)),this):!1};return t.prototype.setContent=function(e){this.$element.html(e)},t.prototype.getContent=function(){return this.$element.html()},t.prototype.open=function(){this.$element.show()},t.prototype.close=function(){this.$element.hide()},t}(jQuery);