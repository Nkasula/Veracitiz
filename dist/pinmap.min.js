/*! pinmap - v2.3.0-beta1 -  2013-08-30
  * Copyright (c) 2013 ; 
 */(function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)})(function(e){"use strict";var t=function(t,o){if(this.options=e.extend({latitude:-31.95391,longitude:115.858512,popup:!1,centerOnMarker:!0},o),!t||!e(t).length)return!1;this.$element=e(t),this.markers=[];var r=e.extend({zoom:11,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(this.options.latitude,this.options.longitude)},this.options),n=e('<div class="gm" style="width:100%;height:100%;" />').appendTo(this.$element);return this.google_map=new google.maps.Map(n[0],r),this.options.popup&&(this.popup=this.options.popup),this};return t.prototype.addMarker=function(e,t,o,r,n,i){var s=this,a=new google.maps.Marker({position:e,map:this.google_map,title:t,icon:r,optimized:!1});return a.id=o,a.popup=this.popup,a.description=n,a.type=i||{},a.current=!1,this.markers.push(a),google.maps.event.addListener(a,"click",function(){a.popup&&(s.popup.getContent()===a.description?s.popup.close():s.showMarker(a))}),a},t.prototype.removeMarker=function(e){var t;for(t=this.markers.length-1;t>=0;t--)this.markers[t].id===e&&(this.markers[t].current=!1,this.markers[t].setMap(null),this.markers.slice(t,1))},t.prototype.showMarker=function(e){e.popup.setContent(e.description),this.options.centerOnMarker===!0&&this.centerOnMarker({id:e.id});for(var t=this.markers.length-1;t>=0;t--)this.markers[t].current=!1;e.current=!0,e.popup.open(e.map,e,this)},t.prototype.nextMarker=function(){var e;for(e=0;this.markers.length>e;e++)if(this.markers[e].current)return this.markers[e+1]!==void 0?this.markers[e+1]:this.markers[0]},t.prototype.nextMarker=function(){var e;for(e=0;this.markers.length>e;e++)if(this.markers[e].current)return this.markers[e+1]!==void 0?this.markers[e+1]:this.markers[0]},t.prototype.previousMarker=function(){var e;for(e=0;this.markers.length>e;e++)if(this.markers[e].current)return this.markers[e-1]!==void 0?this.markers[e-1]:this.markers[this.markers.length-1]},t.prototype.panTo=function(e){return this.google_map.panTo(e)},t.prototype.panToWithOffset=function(e,t,o){var r=this.google_map,n=new google.maps.OverlayView;n.onAdd=function(){var n=this.getProjection(),i=n.fromLatLngToContainerPixel(e);i.x=i.x+t,i.y=i.y+o,r.panTo(n.fromContainerPixelToLatLng(i))},n.draw=function(){},n.setMap(r)},t.prototype.centerOnMarker=function(t){var o=t.id||!1,r=t.title||!1,n=t.zoom||!1,i=t.popup||!1,s=this;return o||r?(e.each(this.markers,function(e,t){(t.title===r||t.id===o)&&(s.panTo(t.position),n&&s.google_map.setZoom(n),i&&s.showMarker(t))}),void 0):!1},t.prototype.toggleMarkers=function(t,o){t=t||!1,e.each(this.markers,function(e,r){t&&r.type===t&&("boolean"==typeof o?r.setVisible(o):r.setVisible(!r.visible))})},t.prototype.locateUser=function(t,o){var r=this,n=e.Deferred();if(t=e.extend({pan:!0,marker:!0,icon:null},t),o=o||!1,"geolocation"in navigator)navigator.geolocation.getCurrentPosition(function(e){r.user_coordinates=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),n.resolve(r.user_coordinates),t.pan&&r.panTo(r.user_coordinates),t.marker&&r.addMarker(r.user_coordinates,"Current Location",null,t.icon),o&&o(r.user_coordinates,r)},function(e){n.reject(e),o&&o(!1,r,e)});else{var i="Device does not support geolocation lookup.";n.reject(i),o&&o(!1,r,i)}return n},t.prototype.buildDirectionsUrl=function(e,t){var o="http://maps.apple.com";return e||t?(e&&t?(o=o+"?saddr="+encodeURIComponent(e),o=o+"&daddr="+encodeURIComponent(t)):o=o+"?saddr="+encodeURIComponent(e||t),o):o},e.fn.pinmap=function(o,r){o=o||{},r="function"==typeof r?r:!1,this.each(function(){var n=e(this),i=new google.maps.Geocoder,s=n.data("pinmap"),a=void 0!==n.attr("data-address")?n.attr("data-address"):!1;s||n.data("pinmap",s=new t(this,o)),a&&i.geocode({address:a},function(e,t){var r;t!==google.maps.GeocoderStatus.ZERO_RESULTS&&(r=e[0].geometry.location,s.panTo(r),o.addPin&&s.addMarker(r,a))}),r&&r.call(this,s)})},t}),window.PopupSlider=function(e){"use strict";var t=function(t){return t.length?(this.$element=t.find(".infoslider"),this.$element.length||(this.$element=e('<div class="popup-infoslider"></div>'),t.append(this.$element)),this):!1};return t.prototype.setContent=function(e){this.$element.html(e)},t.prototype.getContent=function(){return this.$element.html()},t.prototype.open=function(){this.$element.show()},t.prototype.close=function(){this.$element.hide()},t}(jQuery);