/*! Pinmap - v2.2.8 - 2013-07-04
* https://github.com/hatchddigital/pinmap
* Copyright (c) 2013 Hatchd Digital; Licensed MIT */
(function(e){"use strict";typeof define=="function"&&define.amd?define(["jquery"],e):e(window.jQuery)})(function(e){"use strict";var t=function(t,n){this.options=e.extend({latitude:-31.95391,longitude:115.858512,popup:!1,centerOnMarker:!0},n);if(!t||!e(t).length)return!1;var r=e.extend({zoom:11,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(this.options.latitude,this.options.longitude)},this.options);this.$element=e(t);var i=e('<div class="gm" style="width:100%;height:100%" />');return this.google_map=new google.maps.Map(i[0],r),this.$element.append(i),this.available_markers=[],this.options.popup&&(this.popup=this.options.popup),this};return t.prototype.addMarker=function(e,t,n,r,i,s){var o=this,u=new google.maps.Marker({position:e,map:this.google_map,title:t,icon:r,optimized:!1});u.id=n,u.popup=this.popup,u.description=i,u.type=s||{},this.available_markers.push(u),google.maps.event.addListener(u,"click",function(){u.popup&&(o.popup.getContent()===u.description?o.popup.close():o.showMarker(u))})},t.prototype.removeMarker=function(e){for(var t=this.available_markers.length-1;t>=0;t--)this.available_markers[t].id===e&&(this.available_markers[t].setMap(null),this.available_markers.slice(t,1))},t.prototype.showMarker=function(e){e.popup.setContent(e.description),this.options.centerOnMarker===!0&&this.centerOnMarker({id:e.id}),e.popup.open(e.map,e,this)},t.prototype.panTo=function(e){return this.google_map.panTo(e)},t.prototype.panToWithOffset=function(e,t,n){var r=this.google_map,i=new google.maps.OverlayView;i.onAdd=function(){var i=this.getProjection(),s=i.fromLatLngToContainerPixel(e);s.x=s.x+t,s.y=s.y+n,r.panTo(i.fromContainerPixelToLatLng(s))},i.draw=function(){},i.setMap(r)},t.prototype.centerOnMarker=function(t){var n=t.id||!1,r=t.title||!1,i=t.zoom||!1,s=t.popup||!1,o=this;if(!n&&!r)return!1;e.each(this.available_markers,function(e,t){if(t.title===r||t.id===n)o.panTo(t.position),i&&o.google_map.setZoom(i),s&&o.showMarker(t)})},t.prototype.toggleMarkers=function(t,n){t=t||!1,e.each(this.available_markers,function(e,r){t&&r.type===t&&(typeof n=="boolean"?r.setVisible(n):r.setVisible(!r.visible))})},t.prototype.locateUser=function(t,n){var r=this,i=e.Deferred();t=e.extend({pan:!0,marker:!0,icon:null},t),n=n||!1;if("geolocation"in navigator)navigator.geolocation.getCurrentPosition(function(e){r.user_coordinates=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),i.resolve(r.user_coordinates),t.pan&&r.panTo(r.user_coordinates),t.marker&&r.addMarker(r.user_coordinates,"Current Location",null,t.icon),n&&n(r.user_coordinates,r)},function(e){i.reject(e),n&&n(!1,r,e)});else{var s="Device does not support geolocation lookup.";i.reject(s),n&&n(!1,r,s)}return i},t.prototype.buildDirectionsUrl=function(e,t){var n="http://maps.apple.com";return!e&&!t?n:(e&&t?(n=n+"?saddr="+encodeURIComponent(e),n=n+"&daddr="+encodeURIComponent(t)):n=n+"?saddr="+encodeURIComponent(e||t),n)},e.fn.pinmap=function(n,r){n=n||{},r=typeof r=="function"?r:!1,this.each(function(){var i=e(this),s=new google.maps.Geocoder,o=i.data("pinmap"),u=i.attr("data-address")!==undefined?i.attr("data-address"):!1;o||i.data("pinmap",o=new t(this,n)),u&&s.geocode({address:u},function(e,t){var r;t!==google.maps.GeocoderStatus.ZERO_RESULTS&&(r=e[0].geometry.location,o.panTo(r),n.addPin&&o.addMarker(r,u))}),r&&r.call(this,o)})},t});